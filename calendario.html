<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OxxoMaxTrding - Gesti√≥n de Pagos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6e00ff;
            --secondary: #00f7ff;
            --dark: #0a0a20;
            --light: #f0f0ff;
            --accent: #ff00aa;
            --warning: #ffcc00;
            --danger: #ff3300;
            --success: #00ff88;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--dark);
            color: var(--light);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(110, 0, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 247, 255, 0.1) 0%, transparent 20%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            border-bottom: 1px solid var(--primary);
            padding-bottom: 1rem;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 4px 15px rgba(110, 0, 255, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(110, 0, 255, 0.6);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }
        
        .card {
            background: rgba(10, 10, 32, 0.7);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(110, 0, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 15px 40px rgba(110, 0, 255, 0.2);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(110, 0, 255, 0.3);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--secondary);
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(20, 20, 50, 0.5);
            border: 1px solid rgba(110, 0, 255, 0.5);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(0, 247, 255, 0.3);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .student-card {
            background: rgba(20, 20, 50, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(110, 0, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }
        
        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(110, 0, 255, 0.2);
        }
        
        .student-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        .student-info {
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
            color: rgba(240, 240, 255, 0.8);
        }
        
        .payment-dates {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed rgba(110, 0, 255, 0.3);
        }
        
        .payment-date {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .status {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .status-pending {
            background-color: rgba(255, 204, 0, 0.2);
            color: var(--warning);
        }
        
        .status-pending:hover {
            background-color: rgba(255, 204, 0, 0.4);
        }
        
        .status-paid {
            background-color: rgba(0, 255, 100, 0.2);
            color: var(--success);
        }
        
        .status-overdue {
            background-color: rgba(255, 51, 0, 0.2);
            color: var(--danger);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--dark);
            border-radius: 15px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--primary);
            box-shadow: 0 20px 50px rgba(110, 0, 255, 0.3);
            transform: scale(0.9);
            transition: all 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(110, 0, 255, 0.3);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            color: var(--accent);
        }
        
        /* Estilos del calendario */
        .calendar-container {
            margin-top: 3rem;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .calendar-title {
            font-size: 1.5rem;
            color: var(--secondary);
        }
        
        .calendar {
            width: 100%;
            border-collapse: collapse;
        }
        
        .calendar th {
            padding: 1rem;
            text-align: center;
            color: var(--secondary);
            font-weight: 500;
            border-bottom: 1px solid rgba(110, 0, 255, 0.3);
        }
        
        .calendar td {
            padding: 0.8rem;
            text-align: center;
            vertical-align: top;
            border: 1px solid rgba(110, 0, 255, 0.1);
            height: 100px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar td:hover {
            background: rgba(110, 0, 255, 0.1);
        }
        
        .calendar-day {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }
        
        .calendar-event {
            font-size: 0.7rem;
            background: rgba(0, 247, 255, 0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            margin-bottom: 0.2rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .calendar-event.paid {
            background: rgba(0, 255, 136, 0.2);
        }
        
        .calendar-event.pending {
            background: rgba(255, 204, 0, 0.2);
        }
        
        .calendar-event.overdue {
            background: rgba(255, 51, 0, 0.2);
        }
        
        .current-day {
            background: rgba(110, 0, 255, 0.2) !important;
            border: 1px solid var(--primary) !important;
        }
        
        .other-month {
            color: rgba(240, 240, 255, 0.3);
        }
        
        .view-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .view-option {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .view-option.active {
            background: var(--primary);
            color: white;
        }
        
        .view-option:not(.active):hover {
            background: rgba(110, 0, 255, 0.2);
        }
        
        /* Panel de resumen */
        .summary-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .summary-card {
            background: rgba(20, 20, 50, 0.5);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(110, 0, 255, 0.3);
        }
        
        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .summary-label {
            font-size: 0.9rem;
            color: rgba(240, 240, 255, 0.8);
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .calendar td {
                height: 60px;
                padding: 0.3rem;
                font-size: 0.8rem;
            }
            
            .calendar-event {
                display: none;
            }
            
            .summary-panel {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">OxxoMaxTrding</div>
            <button id="termsBtn" class="btn btn-outline pulse">T√©rminos y Condiciones</button>
        </header>
        
        <div class="summary-panel">
            <div class="summary-card">
                <div class="summary-label">Total Estudiantes</div>
                <div class="summary-value" id="totalStudents">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Pagos Completados</div>
                <div class="summary-value" id="paidPayments">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Pagos Pendientes</div>
                <div class="summary-value" id="pendingPayments">0</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Pagos Vencidos</div>
                <div class="summary-value" id="overduePayments">0</div>
            </div>
        </div>
        
        <div class="card glow">
            <div class="card-header">
                <h2 class="card-title">Registrar Nuevo Estudiante</h2>
            </div>
            <form id="studentForm">
                <div class="form-group">
                    <label for="studentName">Nombre del Estudiante</label>
                    <input type="text" id="studentName" placeholder="Ingrese el nombre completo" required>
                </div>
                
                <div class="form-group">
                    <label for="enrollmentDate">Fecha de Inscripci√≥n</label>
                    <input type="date" id="enrollmentDate" required>
                </div>
                
                <div class="form-group">
                    <label for="paymentAmount">Monto de Mensualidad ($)</label>
                    <input type="number" id="paymentAmount" placeholder="Ej: 500" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Registrar Estudiante</button>
            </form>
        </div>
        
        <div class="view-options">
            <div class="view-option active" data-view="calendar"><i class="fas fa-calendar-alt"></i> Calendario</div>
            <div class="view-option" data-view="list"><i class="fas fa-list"></i> Lista de Estudiantes</div>
            <div class="view-option" data-view="reports"><i class="fas fa-chart-bar"></i> Reportes</div>
        </div>
        
        <!-- Vista de Calendario -->
        <div id="calendarView" class="view-content">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h3 class="calendar-title" id="calendarMonthYear">Mes y A√±o</h3>
                    <div class="calendar-nav">
                        <button id="prevMonth" class="btn btn-sm btn-outline"><i class="fas fa-chevron-left"></i></button>
                        <button id="today" class="btn btn-sm btn-outline">Hoy</button>
                        <button id="nextMonth" class="btn btn-sm btn-outline"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                
                <table class="calendar" id="calendar">
                    <thead>
                        <tr>
                            <th>Dom</th>
                            <th>Lun</th>
                            <th>Mar</th>
                            <th>Mi√©</th>
                            <th>Jue</th>
                            <th>Vie</th>
                            <th>S√°b</th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody">
                        <!-- Las celdas del calendario se generar√°n din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Vista de Lista (oculta inicialmente) -->
        <div id="listView" class="view-content" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Estudiantes Registrados</h2>
                </div>
                
                <div class="grid" id="studentsGrid">
                    <!-- Estudiantes se agregar√°n aqu√≠ din√°micamente -->
                </div>
            </div>
        </div>
        
        <!-- Vista de Reportes (oculta inicialmente) -->
        <div id="reportsView" class="view-content" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Reportes de Pagos</h2>
                </div>
                <div id="reportsContent">
                    <canvas id="paymentsChart" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de T√©rminos y Condiciones -->
    <div class="modal" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">T√©rminos y Condiciones de Pago</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="terms-content">
                <h3>Pol√≠tica de Pagos OxxoMaxTrding</h3>
                <p>Al registrarte en nuestro programa, aceptas cumplir con las siguientes condiciones de pago:</p>
                
                <h3>1. Estructura de Pagos</h3>
                <ul>
                    <li>El estudiante debe realizar un pago inicial de inscripci√≥n (50% de la mensualidad) al momento de registrarse.</li>
                    <li>Posteriormente, se deben realizar <span class="highlight">4 pagos mensuales</span> cada 4 semanas exactamente.</li>
                </ul>
                
                <h3>2. Fechas de Pago</h3>
                <ul>
                    <li>Los pagos deben realizarse <span class="highlight">exactamente en la fecha establecida</span> (cada 28 d√≠as).</li>
                    <li>El sistema calcula autom√°ticamente las fechas bas√°ndose en la fecha de inscripci√≥n.</li>
                </ul>
                
                <h3>3. Sanciones por Retraso</h3>
                <ul>
                    <li>Si el pago no se realiza en la fecha establecida, se aplicar√° una <span class="highlight">sanci√≥n de $200</span>.</li>
                    <li>Tienen hasta el <span class="highlight">viernes a las 12:00 pm</span> de esa semana para pagar.</li>
                </ul>
                
                <h3>4. Consecuencias por Incumplimiento</h3>
                <ul>
                    <li>Si no se paga antes del viernes al mediod√≠a, el estudiante <span class="highlight">ser√° retirado del grupo</span>.</li>
                    <li>Para reincorporarse debe pagar la mensualidad atrasada m√°s la sanci√≥n.</li>
                </ul>
                
                <button id="acceptTerms" class="btn btn-primary" style="margin-top: 1.5rem;">Aceptar T√©rminos</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para marcar pago -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar Pago</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="paymentInfo"></p>
                <div class="form-group" style="margin-top: 1rem;">
                    <label for="paymentDate">Fecha de Pago</label>
                    <input type="date" id="paymentDate">
                </div>
                <div class="form-group">
                    <label for="paymentAmountModal">Monto Pagado ($)</label>
                    <input type="number" id="paymentAmountModal" placeholder="Ingrese el monto">
                </div>
                <button id="confirmPayment" class="btn btn-primary" style="margin-top: 1rem;">Confirmar Pago</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Datos de estudiantes (almacenados en localStorage)
        let students = JSON.parse(localStorage.getItem('oxxomaxtrding_students')) || [];
        
        // Variables para el calendario
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        
        // Variables para gr√°ficos
        let paymentsChart = null;
        
        // Elementos del DOM
        const studentForm = document.getElementById('studentForm');
        const studentsGrid = document.getElementById('studentsGrid');
        const termsBtn = document.getElementById('termsBtn');
        const termsModal = document.getElementById('termsModal');
        const paymentModal = document.getElementById('paymentModal');
        const closeModal = document.querySelectorAll('.close-modal');
        const acceptTerms = document.getElementById('acceptTerms');
        const calendarBody = document.getElementById('calendarBody');
        const calendarMonthYear = document.getElementById('calendarMonthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const todayBtn = document.getElementById('today');
        const viewOptions = document.querySelectorAll('.view-option');
        const calendarView = document.getElementById('calendarView');
        const listView = document.getElementById('listView');
        const reportsView = document.getElementById('reportsView');
        const paymentInfo = document.getElementById('paymentInfo');
        const confirmPaymentBtn = document.getElementById('confirmPayment');
        const totalStudentsEl = document.getElementById('totalStudents');
        const paidPaymentsEl = document.getElementById('paidPayments');
        const pendingPaymentsEl = document.getElementById('pendingPayments');
        const overduePaymentsEl = document.getElementById('overduePayments');
        
        // Variables para el pago seleccionado
        let selectedPayment = null;
        
        // Inicializar la fecha de inscripci√≥n con hoy
        document.getElementById('enrollmentDate').valueAsDate = new Date();
        
        // Mostrar modal de t√©rminos
        termsBtn.addEventListener('click', () => {
            termsModal.classList.add('active');
        });
        
        // Cerrar modales
        closeModal.forEach(btn => {
            btn.addEventListener('click', () => {
                termsModal.classList.remove('active');
                paymentModal.classList.remove('active');
            });
        });
        
        // Cerrar modales al hacer clic fuera
        [termsModal, paymentModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
        
        // Aceptar t√©rminos
        acceptTerms.addEventListener('click', () => {
            termsModal.classList.remove('active');
        });
        
        // Cambiar vista entre calendario, lista y reportes
        viewOptions.forEach(option => {
            option.addEventListener('click', () => {
                viewOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                calendarView.style.display = 'none';
                listView.style.display = 'none';
                reportsView.style.display = 'none';
                
                if (option.dataset.view === 'calendar') {
                    calendarView.style.display = 'block';
                    renderCalendar();
                } else if (option.dataset.view === 'list') {
                    listView.style.display = 'block';
                    renderStudents();
                } else if (option.dataset.view === 'reports') {
                    reportsView.style.display = 'block';
                    renderReports();
                }
            });
        });
        
        // Calcular fechas de pago (4 pagos cada 4 semanas)
        function calculatePaymentDates(enrollmentDate, paymentAmount) {
            const dates = [];
            const date = new Date(enrollmentDate);
            
            // Primer pago (inscripci√≥n - 50% del monto mensual)
            dates.push({
                date: new Date(date),
                amount: paymentAmount * 0.5,
                status: 'pending',
                paidDate: null,
                paidAmount: 0
            });
            
            // 4 pagos mensuales (cada 4 semanas)
            for (let i = 1; i <= 4; i++) {
                const nextDate = new Date(date);
                nextDate.setDate(date.getDate() + (i * 28)); // 4 semanas = 28 d√≠as
                dates.push({
                    date: new Date(nextDate),
                    amount: paymentAmount,
                    status: 'pending',
                    paidDate: null,
                    paidAmount: 0
                });
            }
            
            return dates;
        }
        
        // Formatear fecha a string legible
        function formatDate(date) {
            return date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Formatear fecha corta (para el calendario)
        function formatShortDate(date) {
            return date.toLocaleDateString('es-ES', {
                day: 'numeric',
                month: 'short'
            });
        }
        
        // Actualizar estados de pago basados en fecha actual
        function updatePaymentStatuses() {
            const today = new Date();
            
            students.forEach(student => {
                student.paymentDates.forEach(payment => {
                    // Si ya est√° pagado, no cambiar el estado
                    if (payment.status === 'paid') return;
                    
                    const dueDate = new Date(payment.date);
                    
                    // Viernes a las 12:00 pm de la semana del pago
                    const deadline = new Date(dueDate);
                    while (deadline.getDay() !== 5) { // 5 = viernes
                        deadline.setDate(deadline.getDate() + 1);
                    }
                    deadline.setHours(12, 0, 0, 0);
                    
                    if (today > deadline) {
                        payment.status = 'overdue';
                    } else if (today > dueDate) {
                        payment.status = 'pending';
                    } else {
                        payment.status = 'pending'; // A√∫n no es la fecha de pago
                    }
                });
            });
            
            saveToLocalStorage();
        }
        
        // Actualizar resumen de pagos
        function updateSummary() {
            let totalPaid = 0;
            let totalPending = 0;
            let totalOverdue = 0;
            
            students.forEach(student => {
                student.paymentDates.forEach(payment => {
                    if (payment.status === 'paid') {
                        totalPaid++;
                    } else if (payment.status === 'pending') {
                        totalPending++;
                    } else if (payment.status === 'overdue') {
                        totalOverdue++;
                    }
                });
            });
            
            totalStudentsEl.textContent = students.length;
            paidPaymentsEl.textContent = totalPaid;
            pendingPaymentsEl.textContent = totalPending;
            overduePaymentsEl.textContent = totalOverdue;
        }
        
        // Renderizar estudiantes en el grid
        function renderStudents() {
            studentsGrid.innerHTML = '';
            
            if (students.length === 0) {
                studentsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">No hay estudiantes registrados a√∫n.</p>';
                return;
            }
            
            students.forEach((student, index) => {
                const studentCard = document.createElement('div');
                studentCard.className = 'student-card';
                
                let paymentDatesHTML = '';
                student.paymentDates.forEach((payment, i) => {
                    const paymentTitle = i === 0 ? 'Inscripci√≥n' : `Pago ${i}`;
                    const statusClass = `status-${payment.status}`;
                    const statusText = payment.status === 'paid' ? 'Pagado' : payment.status === 'pending' ? 'Pendiente' : 'Vencido';
                    
                    paymentDatesHTML += `
                        <div class="payment-date">
                            <div>
                                <strong>${paymentTitle}:</strong> ${formatDate(new Date(payment.date))}
                                ${payment.status === 'paid' ? `<br><small>Pagado el: ${formatDate(new Date(payment.paidDate))}</small>` : ''}
                            </div>
                            <div>
                                $${payment.amount} 
                                <span class="status ${statusClass}" data-student="${index}" data-payment="${i}">
                                    ${statusText}
                                </span>
                            </div>
                        </div>
                    `;
                });
                
                studentCard.innerHTML = `
                    <h3 class="student-name">${student.name}</h3>
                    <p class="student-info"><strong>Fecha de ingreso:</strong> ${formatDate(new Date(student.enrollmentDate))}</p>
                    <p class="student-info"><strong>Monto mensual:</strong> $${student.paymentAmount}</p>
                    
                    <div class="payment-dates">
                        <h4>Fechas de Pago:</h4>
                        ${paymentDatesHTML}
                    </div>
                `;
                
                studentsGrid.appendChild(studentCard);
            });
            
            // Agregar event listeners a los estados de pago
            document.querySelectorAll('.status').forEach(status => {
                status.addEventListener('click', function() {
                    const studentIndex = parseInt(this.dataset.student);
                    const paymentIndex = parseInt(this.dataset.payment);
                    showPaymentModal(studentIndex, paymentIndex);
                });
            });
            
            updateSummary();
        }
        
        // Mostrar modal para registrar pago
        function showPaymentModal(studentIndex, paymentIndex) {
            const student = students[studentIndex];
            const payment = student.paymentDates[paymentIndex];
            
            selectedPayment = { studentIndex, paymentIndex };
            
            const paymentTitle = paymentIndex === 0 ? 'Inscripci√≥n' : `Pago ${paymentIndex}`;
            
            paymentInfo.innerHTML = `
                <p><strong>Estudiante:</strong> ${student.name}</p>
                <p><strong>Concepto:</strong> ${paymentTitle}</p>
                <p><strong>Fecha de vencimiento:</strong> ${formatDate(new Date(payment.date))}</p>
                <p><strong>Monto a pagar:</strong> $${payment.amount}</p>
                ${payment.status === 'paid' ? `<p><strong>Pagado el:</strong> ${formatDate(new Date(payment.paidDate))}</p>` : ''}
            `;
            
            document.getElementById('paymentDate').valueAsDate = new Date();
            document.getElementById('paymentAmountModal').value = payment.amount;
            
            paymentModal.classList.add('active');
        }
        
        // Confirmar pago
        confirmPaymentBtn.addEventListener('click', () => {
            if (!selectedPayment) return;
            
            const { studentIndex, paymentIndex } = selectedPayment;
            const student = students[studentIndex];
            const payment = student.paymentDates[paymentIndex];
            
            const paymentDate = document.getElementById('paymentDate').value;
            const paymentAmount = parseFloat(document.getElementById('paymentAmountModal').value);
            
            if (!paymentDate || !paymentAmount) {
                alert('Por favor complete todos los campos');
                return;
            }
            
            // Validar monto m√≠nimo
            if (paymentAmount < payment.amount * 0.9) { // Permite un 10% de descuento m√°ximo
                if (!confirm(`El monto ingresado ($${paymentAmount}) es menor que el requerido ($${payment.amount}). ¬øDesea continuar?`)) {
                    return;
                }
            }
            
            // Actualizar estado de pago
            payment.status = 'paid';
            payment.paidDate = paymentDate;
            payment.paidAmount = paymentAmount;
            
            // Cerrar modal y actualizar vistas
            paymentModal.classList.remove('active');
            saveToLocalStorage();
            renderCalendar();
            renderStudents();
            updateSummary();
            
            alert(`Pago registrado exitosamente para ${student.name}`);
        });
        
        // Generar el calendario
        function renderCalendar() {
            // Limpiar calendario
            calendarBody.innerHTML = '';
            
            // Configurar mes y a√±o actual
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            // Actualizar t√≠tulo del calendario
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                              "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            calendarMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Crear celdas del calendario
            let date = 1;
            let today = new Date();
            
            for (let i = 0; i < 6; i++) {
                // Crear fila
                const row = document.createElement('tr');
                
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    
                    if (i === 0 && j < startingDay) {
                        // D√≠as del mes anterior
                        const prevMonthDay = new Date(currentYear, currentMonth, 0).getDate() - (startingDay - j - 1);
                        cell.innerHTML = `<div class="calendar-day other-month">${prevMonthDay}</div>`;
                        cell.classList.add('other-month');
                    } else if (date > daysInMonth) {
                        // D√≠as del pr√≥ximo mes
                        const nextMonthDay = date - daysInMonth;
                        cell.innerHTML = `<div class="calendar-day other-month">${nextMonthDay}</div>`;
                        cell.classList.add('other-month');
                        date++;
                    } else {
                        // D√≠as del mes actual
                        const currentDate = new Date(currentYear, currentMonth, date);
                        const isToday = currentDate.toDateString() === today.toDateString();
                        
                        cell.innerHTML = `<div class="calendar-day">${date}</div>`;
                        
                        if (isToday) {
                            cell.classList.add('current-day');
                        }
                        
                        // Agregar eventos (pagos) a la celda
                        const events = getPaymentsForDate(currentDate);
                        events.forEach(event => {
                            const eventElement = document.createElement('div');
                            eventElement.className = `calendar-event ${event.status}`;
                            eventElement.textContent = `${event.studentName} - $${event.amount}`;
                            eventElement.title = `${event.studentName}\n${event.title}\nMonto: $${event.amount}\nEstado: ${event.status === 'paid' ? 'Pagado' : event.status === 'pending' ? 'Pendiente' : 'Vencido'}`;
                            eventElement.dataset.studentIndex = event.studentIndex;
                            eventElement.dataset.paymentIndex = event.paymentIndex;
                            cell.appendChild(eventElement);
                        });
                        
                        date++;
                    }
                    
                    row.appendChild(cell);
                }
                
                calendarBody.appendChild(row);
                
                // Salir del bucle si ya hemos mostrado todos los d√≠as
                if (date > daysInMonth) {
                    break;
                }
            }
            
            // Agregar event listeners a los eventos del calendario
            document.querySelectorAll('.calendar-event').forEach(event => {
                event.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const studentIndex = parseInt(this.dataset.studentIndex);
                    const paymentIndex = parseInt(this.dataset.paymentIndex);
                    showPaymentModal(studentIndex, paymentIndex);
                });
            });
        }
        
        // Obtener pagos para una fecha espec√≠fica
        function getPaymentsForDate(date) {
            const events = [];
            
            students.forEach((student, studentIndex) => {
                student.paymentDates.forEach((payment, paymentIndex) => {
                    const paymentDate = new Date(payment.date);
                    
                    if (paymentDate.getDate() === date.getDate() && 
                        paymentDate.getMonth() === date.getMonth() && 
                        paymentDate.getFullYear() === date.getFullYear()) {
                        
                        const title = paymentIndex === 0 ? 'Inscripci√≥n' : `Pago ${paymentIndex}`;
                        
                        events.push({
                            studentName: student.name,
                            studentIndex,
                            paymentIndex,
                            title,
                            amount: payment.amount,
                            status: payment.status
                        });
                    }
                });
            });
            
            return events;
        }
        
        // Generar reportes
        function renderReports() {
            const ctx = document.getElementById('paymentsChart').getContext('2d');
            
            // Datos para el gr√°fico
            const labels = [];
            const paidData = [];
            const pendingData = [];
            const overdueData = [];
            
            // √öltimos 6 meses
            const currentDate = new Date();
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentDate);
                date.setMonth(date.getMonth() - i);
                
                const monthName = date.toLocaleDateString('es-ES', { month: 'long' });
                labels.push(monthName.charAt(0).toUpperCase() + monthName.slice(1));
                
                let paid = 0;
                let pending = 0;
                let overdue = 0;
                
                students.forEach(student => {
                    student.paymentDates.forEach(payment => {
                        const paymentDate = new Date(payment.date);
                        if (paymentDate.getMonth() === date.getMonth() && 
                            paymentDate.getFullYear() === date.getFullYear()) {
                            
                            if (payment.status === 'paid') {
                                paid++;
                            } else if (payment.status === 'pending') {
                                pending++;
                            } else if (payment.status === 'overdue') {
                                overdue++;
                            }
                        }
                    });
                });
                
                paidData.push(paid);
                pendingData.push(pending);
                overdueData.push(overdue);
            }
            
            // Destruir gr√°fico anterior si existe
            if (paymentsChart) {
                paymentsChart.destroy();
            }
            
            // Crear nuevo gr√°fico
            paymentsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Pagos Completados',
                            data: paidData,
                            backgroundColor: 'rgba(0, 255, 136, 0.7)',
                            borderColor: 'rgba(0, 255, 136, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Pagos Pendientes',
                            data: pendingData,
                            backgroundColor: 'rgba(255, 204, 0, 0.7)',
                            borderColor: 'rgba(255, 204, 0, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Pagos Vencidos',
                            data: overdueData,
                            backgroundColor: 'rgba(255, 51, 0, 0.7)',
                            borderColor: 'rgba(255, 51, 0, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cantidad de Pagos'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Mes'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Resumen de Pagos por Mes',
                            font: {
                                size: 18
                            }
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const datasetIndex = context.datasetIndex;
                                    const dataIndex = context.dataIndex;
                                    let total = 0;
                                    
                                    if (datasetIndex === 0) total = paidData[dataIndex];
                                    if (datasetIndex === 1) total = pendingData[dataIndex];
                                    if (datasetIndex === 2) total = overdueData[dataIndex];
                                    
                                    return `Total: ${total}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Navegaci√≥n del calendario
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });
        
        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });
        
        todayBtn.addEventListener('click', () => {
            currentDate = new Date();
            currentMonth = currentDate.getMonth();
            currentYear = currentDate.getFullYear();
            renderCalendar();
        });
        
        // Guardar datos en localStorage
        function saveToLocalStorage() {
            localStorage.setItem('oxxomaxtrding_students', JSON.stringify(students));
        }
        
        // Manejar env√≠o del formulario
        studentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value;
            const enrollmentDate = document.getElementById('enrollmentDate').value;
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);
            
            // Validaciones
            if (!studentName || !enrollmentDate || !paymentAmount) {
                alert('Por favor complete todos los campos');
                return;
            }
            
            if (paymentAmount <= 0) {
                alert('El monto de la mensualidad debe ser mayor a 0');
                return;
            }
            
            // Crear nuevo estudiante
            const newStudent = {
                id: Date.now(),
                name: studentName,
                enrollmentDate: enrollmentDate,
                paymentAmount: paymentAmount,
                paymentDates: calculatePaymentDates(enrollmentDate, paymentAmount)
            };
            
            // Actualizar estados de los pagos
            updatePaymentStatuses();
            
            students.push(newStudent);
            saveToLocalStorage();
            
            // Resetear formulario
            studentForm.reset();
            document.getElementById('enrollmentDate').valueAsDate = new Date();
            
            // Actualizar vistas
            renderCalendar();
            renderStudents();
            updateSummary();
            
            // Mostrar confirmaci√≥n
            alert(`Estudiante ${studentName} registrado exitosamente con un pago mensual de $${paymentAmount}`);
        });
        
        // Inicializar la aplicaci√≥n
        function init() {
            updatePaymentStatuses();
            renderCalendar();
            updateSummary();
        }
        
        init();
    </script>
</body>
</html>
